# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞–≤–∏—à —á–µ—Ä–µ–∑ evdev/uinput

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–¥—Ö–æ–¥–∞ –∏–∑ `test_key_suppression_evdev.py` –≤ `tap-launcher` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è –Ω–µ–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∏—Ö –∫–ª–∞–≤–∏—à –ø–æ—Å–ª–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∞–ø–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≥–æ—Ä—è—á–µ–π –∫–ª–∞–≤–∏—à–µ.

**–í–∞–∂–Ω–æ**: 
- –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `clear_key` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ - –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
- –ü–æ–¥–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â—É—é –∫–ª–∞–≤–∏—à—É (trigger_key), –∫–æ—Ç–æ—Ä–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª–∞ —Ç–∞–ø
- –¢–æ–ª—å–∫–æ evdev backend - –ø–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç pynput

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏–∑ POC

1. **–ó–∞—Ö–≤–∞—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**: `device.grab()` - –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–≤—ã–º–∏
2. **–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ**: `UInput` –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—É
3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: 
   - Press ‚Üí –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –≤ –±—É—Ñ–µ—Ä–µ, –ù–ï –≤—ã–∑—ã–≤–∞–µ–º `syn()`
   - Release ‚Üí –≤—ã–∑—ã–≤–∞–µ–º `syn()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞ `[Press, Release]`
   - Repeat ‚Üí –≤—ã–∑—ã–≤–∞–µ–º `syn()` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–∞
4. **–ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ**: –Ω–µ —ç–º—É–ª–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–æ–¥–∞–≤–∏—Ç—å

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ evdev –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

#### 1.1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ detector.py
**–§–∞–π–ª**: `src/common/backends/detector.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ EvdevBackend (–∫–∞–∫ –¥–ª—è tap-detector, —Ç–∞–∫ –∏ –¥–ª—è tap-launcher)
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É: —É–±—Ä–∞—Ç—å –≤—ã–±–æ—Ä –º–µ–∂–¥—É pynput –∏ evdev
- –£–¥–∞–ª–∏—Ç—å fallback –Ω–∞ pynput
- –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö (—É–±—Ä–∞—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è pynput)

**–í–∞–∂–Ω–æ**: `tap-detector` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `TapMonitor`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç `create_backend()`. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π `tap-detector` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å evdev, —á—Ç–æ **–ª—É—á—à–µ**, —Ç–∞–∫ –∫–∞–∫:
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Wayland –∏ X11
- –ï–¥–∏–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞–≤–∏—à (–¥–ª—è –±—É–¥—É—â–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π)

#### 1.2. PynputBackend (—É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ deprecated)
**–§–∞–π–ª**: `src/common/backends/pynput_backend.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é, –ò–õ–ò
- –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ deprecated —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ pyproject.toml (—É–±—Ä–∞—Ç—å pynput –∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö, –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ optional –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏)

---

### –§–∞–∑–∞ 2: EvdevBackend - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞

#### 2.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞
**–§–∞–π–ª**: `src/common/backends/evdev_backend.py`

**–ù–æ–≤—ã–µ –ø–æ–ª—è**:
- `self.uinput_device: UInput | None = None` - –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- `self.suppressed_keycodes: set[int] = set()` - –º–Ω–æ–∂–µ—Å—Ç–≤–æ evdev keycodes –¥–ª—è –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ)
- `self.pressed_keycodes: set[int] = set()` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞–∂–∞—Ç—ã—Ö –∫–ª–∞–≤–∏—à (evdev –∫–æ–¥—ã)
- `self.buffered_presses: dict[int, bool] = {}` - –±—É—Ñ–µ—Ä press —Å–æ–±—ã—Ç–∏–π: `{keycode: True}` - –∫–∞–∫–∏–µ –∫–ª–∞–≤–∏—à–∏ –Ω–∞–∂–∞—Ç—ã –∏ –∂–¥—É—Ç release

#### 2.2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è uinput
**–ú–µ—Ç–æ–¥**: `_create_uinput_device()`

**–õ–æ–≥–∏–∫–∞**:
- –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å uinput –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `start()` (–Ω—É–∂–µ–Ω –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å capabilities –∑–∞—Ö–≤–∞—á–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –°–æ–∑–¥–∞–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```python
def _create_uinput_device(self) -> None:
    """Create uinput device for event emulation.
    
    Always created when start() is called, as we always grab the device
    and need to emulate all events back to the system.
    """
    if self.uinput_device is not None:
        return
    
    if self.device is None:
        raise RuntimeError("Cannot create uinput: device not initialized")
    
    from evdev import UInput, ecodes
    capabilities = {
        ecodes.EV_KEY: self.device.capabilities()[ecodes.EV_KEY]
    }
    self.uinput_device = UInput(capabilities)
    self.logger.info("Created uinput virtual device for event emulation")
```

#### 2.3. –ó–∞—Ö–≤–∞—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
**–ú–µ—Ç–æ–¥**: `start()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å `device.grab()` –ø–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º —Å–æ–±—ã—Ç–∏–π
- –í—ã–∑—ã–≤–∞—Ç—å `device.ungrab()` –≤ `finally` –±–ª–æ–∫–µ
- –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å uinput (–Ω—É–∂–µ–Ω –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—É)

```python
# –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ - –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–≤—ã–º–∏
self.device.grab()
self.logger.debug("Device grabbed, events will be intercepted")

# –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë–º uinput –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—É
self._create_uinput_device()
```

#### 2.4. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏—à–∏
**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥**: `suppress_key(key: Any) -> None`

**–õ–æ–≥–∏–∫–∞**:
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ LauncherMonitor –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ç–∞–ø–∞ —Å –Ω–µ–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∏–º trigger_key
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç pynput Key/KeyCode –æ–±—ä–µ–∫—Ç (trigger_key)
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ evdev keycode –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ `self.suppressed_keycodes`
- **–ü–æ–¥–∞–≤–ª—è–µ—Ç –í–°–ï —Å–æ–±—ã—Ç–∏—è —ç—Ç–æ–π –∫–ª–∞–≤–∏—à–∏** (press, release, repeat), –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –Ω–µ –±—ã–ª–∏ —ç–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã

**–í–∞–∂–Ω–æ**: –ü–æ—Å–∫–æ–ª—å–∫—É `device.grab()` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –î–û –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º—É, –º—ã –º–æ–∂–µ–º –ø–æ–¥–∞–≤–∏—Ç—å –¥–∞–∂–µ press —Å–æ–±—ã—Ç–∏–µ, –µ—Å–ª–∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä–æ.

```python
def suppress_key(self, key: Any) -> None:
    """Suppress a key after tap detection.
    
    This method is called when a tap is detected and matched to a hotkey.
    The trigger_key (non-modifier) should be suppressed to prevent it from
    reaching other applications.
    
    Args:
        key: pynput Key/KeyCode object to suppress (typically trigger_key)
    """
    from .key_mapping import pynput_to_evdev_code
    
    try:
        keycode = pynput_to_evdev_code(key)
        self.suppressed_keycodes.add(keycode)
        self.logger.debug(f"Suppressing keycode {keycode} (key: {key})")
    except KeyError:
        self.logger.warning(f"Cannot suppress key {key}: no evdev mapping")
```

#### 2.5. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Å –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ–º
**–ú–µ—Ç–æ–¥**: `start()` - —Ü–∏–∫–ª —á—Ç–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ**: 
1. –õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑ POC
2. **–û—Ç–ª–æ–∂–∏—Ç—å —ç–º—É–ª—è—Ü–∏—é press –¥–æ –≤—ã–∑–æ–≤–∞ callback** - —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–¥–∞–≤–∏—Ç—å press —Å–æ–±—ã—Ç–∏–µ

```python
for event in self.device.read_loop():
    if event.type != ecodes.EV_KEY:
        continue
    
    keycode = event.code
    value = event.value  # 0=release, 1=press, 2=repeat
    
    if value == 1:  # Press
        # –ö–†–ò–¢–ò–ß–ù–û: –°–Ω–∞—á–∞–ª–∞ –≤—ã–∑—ã–≤–∞–µ–º callback, –ø–æ—Ç–æ–º —Ä–µ—à–∞–µ–º –æ–± —ç–º—É–ª—è—Ü–∏–∏
        # –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–∞–≤–∏—Ç—å press —Å–æ–±—ã—Ç–∏–µ, –µ—Å–ª–∏ —Ç–∞–ø –æ–±–Ω–∞—Ä—É–∂–µ–Ω
        pynput_key = evdev_to_pynput_key(key_event.keycode)
        on_press(pynput_key)  # –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ - –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
        
        # –ü–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ callback –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–¥–∞–≤–ª—è—Ç—å
        if self._should_suppress_event(keycode, value):
            self.logger.debug(f"Suppressing press: keycode={keycode}")
            # –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –Ω–∞–∂–∞—Ç—É—é –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (–¥–ª—è release)
            self.pressed_keycodes.add(keycode)
            continue  # –ù–ï —ç–º—É–ª–∏—Ä—É–µ–º
        
        # –≠–º—É–ª–∏—Ä—É–µ–º press - –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –≤ –±—É—Ñ–µ—Ä–µ, –ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º
        self.uinput_device.write(ecodes.EV_KEY, keycode, 1)
        self.buffered_presses[keycode] = True
        self.pressed_keycodes.add(keycode)
    
    elif value == 0:  # Release
        # –í—ã–∑—ã–≤–∞–µ–º callback
        pynput_key = evdev_to_pynput_key(key_event.keycode)
        on_release(pynput_key)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ü–û–°–õ–ï callback
        if self._should_suppress_event(keycode, value):
            self.logger.debug(f"Suppressing release: keycode={keycode}")
            self.pressed_keycodes.discard(keycode)
            continue  # –ù–ï —ç–º—É–ª–∏—Ä—É–µ–º
        
        # –≠–º—É–ª–∏—Ä—É–µ–º release - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—ã–π –ø–∞–∫–µ—Ç [Press, Release]
        if keycode in self.buffered_presses:
            # –ï—Å–ª–∏ press –±—ã–ª —ç–º—É–ª–∏—Ä–æ–≤–∞–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º release –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º
            self.uinput_device.write(ecodes.EV_KEY, keycode, 0)
            self.uinput_device.syn()  # –ö–†–ò–¢–ò–ß–ù–û: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–¥–µ—Å—å
            self.buffered_presses.pop(keycode, None)
        # –ï—Å–ª–∏ press –±—ã–ª –ø–æ–¥–∞–≤–ª–µ–Ω - –ù–ï —ç–º—É–ª–∏—Ä—É–µ–º release —Ç–æ–∂–µ
        # (—Å–∏—Å—Ç–µ–º–∞ –Ω–µ –≤–∏–¥–µ–ª–∞ press, –ø–æ—ç—Ç–æ–º—É release –±—É–¥–µ—Ç –ª–∏—à–Ω–∏–º)
        
        self.pressed_keycodes.discard(keycode)
    
    elif value == 2:  # Repeat
        # –ê–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä - –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ
        if self._should_suppress_event(keycode, value):
            self.logger.debug(f"Suppressing repeat: keycode={keycode}")
            continue
        
        # –≠–º—É–ª–∏—Ä—É–µ–º repeat - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
        self.uinput_device.write(ecodes.EV_KEY, keycode, 2)
        self.uinput_device.syn()
```

#### 2.6. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
**–ú–µ—Ç–æ–¥**: `_should_suppress_event(keycode: int, value: int) -> bool`

**–õ–æ–≥–∏–∫–∞**:
- –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –≤—Ö–æ–¥–∏—Ç –ª–∏ keycode –≤ `self.suppressed_keycodes`
- –î–ª—è **Press (value=1)**: –ø–æ–¥–∞–≤–ª—è–µ–º, –µ—Å–ª–∏ keycode –≤ —Å–ø–∏—Å–∫–µ –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã—Ö
- –î–ª—è **Release (value=0)**: –ø–æ–¥–∞–≤–ª—è–µ–º, —É–¥–∞–ª—è–µ–º –∏–∑ —Å–ø–∏—Å–∫–∞ –ø–æ—Å–ª–µ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è
- –î–ª—è **Repeat (value=2)**: –ø–æ–¥–∞–≤–ª—è–µ–º

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç**: –ü–æ—Å–∫–æ–ª—å–∫—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `device.grab()`, —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –î–û –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º—É. –ö –º–æ–º–µ–Ω—Ç—É –≤—ã–∑–æ–≤–∞ `suppress_key()` –∏–∑ callback'–∞ press —Å–æ–±—ã—Ç–∏–µ —É–∂–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ, –Ω–æ –µ—â—ë –ù–ï —ç–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—É. –ó–Ω–∞—á–∏—Ç, –º–æ–∂–µ–º –µ–≥–æ –ø–æ–¥–∞–≤–∏—Ç—å.

**–ü—Ä–æ–±–ª–µ–º–∞**: `suppress_key()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏–∑ callback'–∞ `_on_tap_detected`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `_on_press` –≤ TapMonitor. –ö —ç—Ç–æ–º—É –º–æ–º–µ–Ω—Ç—É press —Å–æ–±—ã—Ç–∏–µ —É–∂–µ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —Ü–∏–∫–ª–µ backend'–∞.

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ –¥–ª—è "–ø–æ–¥–∞–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏":
- –í —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π backend'–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –±—É–¥—É—â–∏—Ö —Ç–∞–ø–æ–≤
- –ò–õ–ò: –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å press —Å–æ–±—ã—Ç–∏—è –≤ –±—É—Ñ–µ—Ä–µ –¥–æ –≤—ã–∑–æ–≤–∞ callback'–∞
- –ò–õ–ò: –≤—ã–∑—ã–≤–∞—Ç—å `suppress_key()` —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ –º–æ–º–µ–Ω—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ç–∞–ø–∞ (–¥–æ —ç–º—É–ª—è—Ü–∏–∏)

–ù–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç: **–æ—Ç–ª–æ–∂–∏—Ç—å —ç–º—É–ª—è—Ü–∏—é press –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Ç–∞–ø–æ–º**.

```python
def _should_suppress_event(self, keycode: int, value: int) -> bool:
    """Determine if event should be suppressed.
    
    Args:
        keycode: Evdev key code
        value: Event value (0=release, 1=press, 2=repeat)
    
    Returns:
        True if event should be suppressed
    
    Note:
        Since device.grab() intercepts events before they reach the system,
        we can suppress press events too, if suppress_key() was called before
        emulation happened. However, there's a timing challenge: callback is
        async. See implementation strategy below.
    """
    if keycode in self.suppressed_keycodes:
        # Suppress all events (press, release, repeat)
        if value == 0:  # Release - remove after suppression (one-time)
            self.suppressed_keycodes.discard(keycode)
        return True
    
    return False
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
1. –í —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π: –≤—ã–∑—ã–≤–∞—Ç—å callback `on_press` –°–ò–ù–•–†–û–ù–ù–û
2. TapMonitor –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∞–ø —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ `_on_press`
3. –ï—Å–ª–∏ —Ç–∞–ø –≤–∞–ª–∏–¥–Ω—ã–π ‚Üí LauncherMonitor –≤—ã–∑—ã–≤–∞–µ—Ç `suppress_key()` –°–ò–ù–•–†–û–ù–ù–û
4. –¢–æ–ª—å–∫–æ –ü–û–°–õ–ï —ç—Ç–æ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Ü–∏–∫–ª backend'–∞ –∏ —Ä–µ—à–∞–µ–º, —ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –ª–∏ press
5. –ï—Å–ª–∏ keycode –≤ `suppressed_keycodes` ‚Üí –Ω–µ —ç–º—É–ª–∏—Ä—É–µ–º

–≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞: callback –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –∏ –º—ã –¥–æ–ª–∂–Ω—ã –∂–¥–∞—Ç—å –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —ç–º—É–ª—è—Ü–∏–µ–π –¥–ª—è press —Å–æ–±—ã—Ç–∏–π.

#### 2.7. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è emit_key_event (—É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)
**–ú–µ—Ç–æ–¥**: `emit_key_event(key: Any, is_press: bool) -> None`

**–í–∞–∂–Ω–æ**: –í –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - –≤—Å—è —ç–º—É–ª—è—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π. –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ no-op –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –∏–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

#### 2.8. –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
**–ú–µ—Ç–æ–¥**: `stop()` –∏ `__del__`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –í—ã–∑—ã–≤–∞—Ç—å `device.ungrab()` –≤ `finally` –±–ª–æ–∫–µ `start()`
- –ó–∞–∫—Ä—ã–≤–∞—Ç—å `uinput_device` –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
- –ó–∞–∫—Ä—ã–≤–∞—Ç—å `device` –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LauncherMonitor

#### 3.1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ _on_tap_detected
**–§–∞–π–ª**: `src/tap_launcher/launcher_monitor.py`

**–ú–µ—Ç–æ–¥**: `_on_tap_detected()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ç–∞–ø–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ hotkey, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `has_non_modifier`
- –ï—Å–ª–∏ `has_non_modifier=True` –∏ –µ—Å—Ç—å `trigger_key` - –≤—ã–∑–≤–∞—Ç—å `backend.suppress_key(trigger_key)`
- –£–±—Ä–∞—Ç—å –≤—Å—é —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É —ç–º—É–ª—è—Ü–∏–∏ —á–µ—Ä–µ–∑ wrappers - —Ç–µ–ø–µ—Ä—å backend —Å–∞–º —ç–º—É–ª–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è

```python
def _on_tap_detected(
    self,
    keys: set[Any],
    duration: float,
    trigger_key: Any,
    has_non_modifier: bool
) -> None:
    """Callback when a valid tap is detected."""
    # Try to match against configured hotkeys
    hotkey = self.matcher.match(keys)

    if hotkey:
        # Found a matching hotkey
        keys_str = '+'.join(sorted(hotkey.keys))

        if hotkey.description:
            self.logger.info(
                f'Tap detected: {hotkey.description} '
                f'(keys: {keys_str}, duration: {duration:.3f}s)'
            )
        else:
            self.logger.info(
                f'Tap detected: {keys_str} (duration: {duration:.3f}s)'
            )

        # Execute the command
        success = self.executor.execute(hotkey)

        if not success:
            self.logger.warning(
                f'Command execution failed for hotkey: {keys_str}'
            )

        # NEW: Suppress trigger key if it's a non-modifier
        if has_non_modifier and trigger_key:
            from common.key_normalizer import is_modifier_key
            if not is_modifier_key(trigger_key):
                # Suppress the non-modifier trigger key
                backend = self.tap_monitor.backend
                if hasattr(backend, 'suppress_key'):
                    backend.suppress_key(trigger_key)
                    self.logger.debug(f"Suppressed trigger key: {trigger_key}")
                else:
                    self.logger.warning(
                        "Backend doesn't support key suppression"
                    )

    else:
        # No matching hotkey - all keys will be emitted normally by backend
        if self.config.debug_mode:
            keys_str = format_keys_display(keys)
            self.logger.debug(
                f'Tap detected but no matching hotkey: {keys_str} '
                f'(duration: {duration:.3f}s)'
            )
```

#### 3.2. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö wrappers
**–§–∞–π–ª**: `src/tap_launcher/launcher_monitor.py`

**–ú–µ—Ç–æ–¥—ã**: `start()`, `on_press_wrapper()`, `on_release_wrapper()`, `_emit_key()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –£–±—Ä–∞—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É —ç–º—É–ª—è—Ü–∏–∏ —á–µ—Ä–µ–∑ wrappers - –æ–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞
- Backend —Å–∞–º —ç–º—É–ª–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ uinput
- –í—ã–∑—ã–≤–∞—Ç—å `backend.start()` –Ω–∞–ø—Ä—è–º—É—é —Å callbacks –∏–∑ TapMonitor

```python
def start(self) -> None:
    """Start monitoring keyboard (blocking call)."""
    self.logger.info(
        f'Starting tap launcher with timeout {self.config.tap_timeout}s'
    )
    self.logger.info(
        f'Monitoring {len(self.config.hotkeys)} hotkey combination(s)'
    )

    # Start tap monitor - backend handles all event emulation internally
    try:
        self.tap_monitor.start()
    except KeyboardInterrupt:
        self.logger.info('Received interrupt signal, shutting down...')
        raise
```

#### 3.3. –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω–æ–≥–æ –∫–æ–¥–∞
**–£–¥–∞–ª–∏—Ç—å**:
- `_emulated_events`, `_press_was_emitted`, `_releasing_keys`, `_suppressed_trigger_keys` –ø–æ–ª—è
- –ú–µ—Ç–æ–¥—ã `_emit_key()`, `on_press_wrapper()`, `on_release_wrapper()`
- –í—Å—é –ª–æ–≥–∏–∫—É —ç–º—É–ª—è—Ü–∏–∏ —á–µ—Ä–µ–∑ pynput Controller

---

### –§–∞–∑–∞ 4: –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

#### 4.1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è - –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ hotkey.

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):
```toml
[[hotkeys]]
keys = ["ctrl_r", "delete"]
command = "/usr/bin/flameshot"
description = "Screenshot (delete key will be suppressed automatically)"
```

#### 4.2. –ü–æ–≤–µ–¥–µ–Ω–∏–µ
- **–°—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: pynput —ç–º—É–ª–∏—Ä–æ–≤–∞–ª —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ Controller
- **–ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: evdev —ç–º—É–ª–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ uinput
- –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –ø—Ä–æ–∑—Ä–∞—á–Ω–æ, –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ
- –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –Ω–µ–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∏—Ö –∫–ª–∞–≤–∏—à

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞)
1. ‚úÖ –ò–∑—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
2. ‚úÖ –°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω
3. üìù –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ uinput

### –≠—Ç–∞–ø 2: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ evdev –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
1. –û–±–Ω–æ–≤–∏—Ç—å `detector.py` - –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EvdevBackend
2. –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ deprecated `pynput_backend.py`
3. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `pyproject.toml`
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å tap-detector** - —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å evdev
5. –¢–µ—Å—Ç—ã: –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç evdev

### –≠—Ç–∞–ø 3: EvdevBackend - –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –¥–ª—è –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_create_uinput_device()`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `device.grab()`/`ungrab()`
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é —ç–º—É–ª—è—Ü–∏—é —Å–æ–±—ã—Ç–∏–π (–±–µ–∑ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è)
5. –¢–µ—Å—Ç—ã: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ü–∏–∏

### –≠—Ç–∞–ø 4: EvdevBackend - –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `suppress_key()` –º–µ—Ç–æ–¥
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_should_suppress_event()`
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è –≤ —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π
4. –¢–µ—Å—Ç—ã: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è trigger_key

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LauncherMonitor
1. –û–±–Ω–æ–≤–∏—Ç—å `_on_tap_detected()` –¥–ª—è –≤—ã–∑–æ–≤–∞ `suppress_key()`
2. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ wrappers –∏ –ª–æ–≥–∏–∫—É —ç–º—É–ª—è—Ü–∏–∏
3. –£–ø—Ä–æ—Å—Ç–∏—Ç—å `start()` –º–µ—Ç–æ–¥
4. –¢–µ—Å—Ç—ã: end-to-end —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π

### –≠—Ç–∞–ø 6: –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases
1. –ú–Ω–æ–≥–æ–∫–ª–∞–≤–∏—à–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (3+ –∫–ª–∞–≤–∏—à–∏)
2. –ß–∞—Å—Ç–∏—á–Ω–æ–µ –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ (–æ–¥–Ω–∞ –∫–ª–∞–≤–∏—à–∞ –∏–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏)
3. –û—à–∏–±–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è uinput (–ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞)
4. Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ uinput

### –≠—Ç–∞–ø 7: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
1. –û–±–Ω–æ–≤–∏—Ç—å README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø—Ä–∞–≤
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è pynput
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
**–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û**:
```python
ui.write(EV_KEY, keycode, 1)  # Press
ui.syn()  # ‚ùå –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –ø–∞–∫–µ—Ç
ui.write(EV_KEY, keycode, 0)  # Release
ui.syn()  # ‚ùå –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –ø–∞–∫–µ—Ç
```

**–ü–†–ê–í–ò–õ–¨–ù–û**:
```python
ui.write(EV_KEY, keycode, 1)  # Press (–±—É—Ñ–µ—Ä)
# ... –≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–¥–∏—Ç ...
ui.write(EV_KEY, keycode, 0)  # Release (—Ç–æ—Ç –∂–µ –±—É—Ñ–µ—Ä)
ui.syn()  # ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—ã–π –ø–∞–∫–µ—Ç [Press, Release]
```

### 2. –ê–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä
–î–ª—è –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä–∞ (value=2) –∫–∞–∂–¥—ã–π repeat –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å `syn()`:
```python
ui.write(EV_KEY, keycode, 2)  # Repeat
ui.syn()  # ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π repeat
```

### 3. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `list[str]` (normalized names)
- TapMonitor: `set[Any]` (pynput Key/KeyCode)
- EvdevBackend: `set[int]` (evdev keycodes)

–ù—É–∂–Ω–∞ —Ü–µ–ø–æ—á–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π.

### 4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è
–ü–æ–¥–∞–≤–ª—è—Ç—å –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ trigger_key (–Ω–µ–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â—É—é –∫–ª–∞–≤–∏—à—É), –µ—Å–ª–∏:
- –¢–∞–ø –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω (–≤–∞–ª–∏–¥–Ω—ã–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç hotkey)
- `has_non_modifier=True` (—Ç–∞–ø —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â—É—é –∫–ª–∞–≤–∏—à—É)
- `trigger_key` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º

–ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ç–∞–ø–∞ —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ `backend.suppress_key(trigger_key)`.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit-—Ç–µ—Å—Ç—ã
- –í—ã–∑–æ–≤ `suppress_key()` —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –∫–ª–∞–≤–∏—à
- –õ–æ–≥–∏–∫–∞ `_should_suppress_event()` –¥–ª—è press/release/repeat
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ `suppressed_keycodes` –ø–æ—Å–ª–µ release

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- End-to-end —Å —Ä–µ–∞–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
1. RCtrl+Delete ‚Üí Delete –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è (–Ω–µ–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä), RCtrl –Ω–µ –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è
2. Ctrl+Shift+A ‚Üí A –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è (–Ω–µ–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä), Ctrl+Shift –Ω–µ –ø–æ–¥–∞–≤–ª—è—é—Ç—Å—è
3. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä-only —Ç–∞–ø (Ctrl+Shift) ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è (–Ω–µ—Ç –Ω–µ–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞)
4. –¢–∞–ø –±–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ hotkey ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è, –≤—Å–µ –∫–ª–∞–≤–∏—à–∏ —ç–º—É–ª–∏—Ä—É—é—Ç—Å—è

---

## –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ uinput
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ udev –ø—Ä–∞–≤–∏–ª

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è —Å pynput –Ω–∞ evdev
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å evdev, —É–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç pynput

### 3. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é `pynput_to_evdev_code()`, –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

### 4. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
**–û—Ü–µ–Ω–∫–∞**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π in-memory

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü–ª–∞–Ω –æ–±—Å—É–∂–¥–µ–Ω –∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω
2. **–ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 2** (—É–¥–∞–ª–µ–Ω–∏–µ pynput) - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—Ç–µ
3. **–≠—Ç–∞–ø 3-4** (EvdevBackend) - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
4. **–≠—Ç–∞–ø 5** (LauncherMonitor) - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
5. **–≠—Ç–∞–ø 6-7** (edge cases, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è) - —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –¢–∞–π–º–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π –∏ –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ press

**–í–∞–∂–Ω–æ**: –° `device.grab()` —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –î–û –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º—É!

**–ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏**:
1. –§–∏–∑–∏—á–µ—Å–∫–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏ ‚Üí —Å–æ–±—ã—Ç–∏–µ –≤ `/dev/input/event*`
2. `device.grab()` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ (–î–û —Å–∏—Å—Ç–µ–º—ã)
3. Backend —á–∏—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `read_loop()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `on_press()` callback
4. TapMonitor –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π —Ç–∞–ø
5. LauncherMonitor —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `backend.suppress_key(trigger_key)`
6. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–∑ callback ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `_should_suppress_event()`
7. –ï—Å–ª–∏ –ø–æ–¥–∞–≤–ª—è–µ–º ‚Üí –ù–ï —ç–º—É–ª–∏—Ä—É–µ–º press –≤ —Å–∏—Å—Ç–µ–º—É
8. –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–∞–≤–ª—è–µ–º ‚Üí —ç–º—É–ª–∏—Ä—É–µ–º press —á–µ—Ä–µ–∑ uinput

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç**: Callback –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ **–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è** –¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞. –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è evdev - –≤—ã–∑–æ–≤—ã –∏–∑ `read_loop()` –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ.

–ü–æ—ç—Ç–æ–º—É –º–æ–∂–µ–º –ø–æ–¥–∞–≤–∏—Ç—å press —Å–æ–±—ã—Ç–∏–µ, –µ—Å–ª–∏:
- Callback –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- `suppress_key()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ callback
- –≠–º—É–ª—è—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ü–û–°–õ–ï –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ callback

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è
- –ü–æ–¥–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∏–µ –∫–ª–∞–≤–∏—à–∏
- –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (Ctrl, Shift, Alt) –ù–ï –ø–æ–¥–∞–≤–ª—è—é—Ç—Å—è - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ –æ–∂–∏–¥–∞–µ–º–æ
- –ï—Å–ª–∏ —Ç–∞–ø —Å–æ—Å—Ç–æ–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ - –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π in-memory
- `device.grab()` –¥–∞–µ—Ç —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø, –Ω–æ —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è —Ç–∞–∫–æ–≥–æ —Ä–æ–¥–∞ —É—Ç–∏–ª–∏—Ç

