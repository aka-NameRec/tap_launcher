# –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Wayland —á–µ—Ä–µ–∑ backend-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é

**–î–∞—Ç–∞:** 24 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ç–∫–∞:** `feature/20251024-052851-wayland_support`  
**–°—Ç–∞—Ç—É—Å:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç –æ–±—Å—É–∂–¥–µ–Ω–∏—è)

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞

### üìÑ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

1. **`WAYLAND-SUPPORT-PROPOSAL-v2.md`** - –ò—Ç–æ–≥–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ‚≠ê
   - –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ —Ä–µ—à–µ–Ω–∏—è
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å `src/common/`
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
   - Plan —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

2. **`wayland-backend-design-v2.md`** - –î–µ—Ç–∞–ª—å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω
   - –ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è backend-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
   - –ö–æ–¥ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
   - –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (6-8 —á–∞—Å–æ–≤)
   - –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

3. **`PROJECT-STRUCTURE-v2.md`** - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
   - –î–∏–∞–≥—Ä–∞–º–º—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - –î–æ/–ø–æ—Å–ª–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
   - –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–ª–∞–Ω

4. **`V1-TO-V2-CHANGES.md`** - –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç v1 –∫ v2
   - –ü–æ—á–µ–º—É v1 –±—ã–ª–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä
   - Checklist –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

5. **`ABC-VS-PROTOCOL.md`** - –û–±—Å—É–∂–¥–µ–Ω–∏–µ ABC vs Protocol
   - –ü–æ—á–µ–º—É Protocol –ª—É—á—à–µ –¥–ª—è backend-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### üß™ Proof-of-Concept

6. **`poc-evdev-test.py`** - –¢–µ—Å—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ evdev
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ evdev
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
   - –ü–æ–∏—Å–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ó–∞–ø—É—Å–∫:**
```bash
pip install evdev
python docs/20251024-052851-proposal-wayland_support/poc-evdev-test.py
```

### üìÅ –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

7. **`backend-examples/`** - –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ –ø—Ä–∏–º–µ—Ä—ã backend'–æ–≤
   - `01-base.py` - –ë–∞–∑–æ–≤–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è (Protocol)
   - `02-pynput-backend.py` - X11 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
   - `03-evdev-backend-simplified.py` - Wayland —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
   - `04-integration-example.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TapMonitor
   - `README-v2.md` - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤

**–ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–æ–≤:**
```bash
cd docs/20251024-052851-proposal-wayland_support/backend-examples
python 02-pynput-backend.py
python 03-evdev-backend-simplified.py
```

### üìú –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (v1)

- `wayland-backend-design.md` - v1 (backend'—ã –≤ tap_detector)
- `WAYLAND-SUPPORT-PROPOSAL.md` - v1 (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

‚ö†Ô∏è **–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v1 –±—ã–ª–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ v2.

---

## –°—É—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞
- `pynput` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å X11
- KUbuntu 25.10 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Wayland –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `tap_detector` –∏ `tap_launcher` –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ Wayland

### –†–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞—Ç—å **–æ–±—â–∏–π –º–æ–¥—É–ª—å** `src/common/` —Å backend-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–µ–π:
- **PynputBackend** –¥–ª—è X11 (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- **EvdevBackend** –¥–ª—è Wayland (–Ω–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- **–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** backend'–∞ –ø–æ —Å—Ä–µ–¥–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ common/                    # ‚Üê –û–ë–©–ò–ô –ö–û–î
‚îÇ   ‚îú‚îÄ‚îÄ backends/              # Backend'—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py           # Protocol-based –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pynput_backend.py # X11
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ evdev_backend.py  # Wayland
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ key_mapping.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ detector.py
‚îÇ   ‚îî‚îÄ‚îÄ key_normalizer.py
‚îÇ
‚îú‚îÄ‚îÄ tap_detector/              # –∏—Å–ø–æ–ª—å–∑—É–µ—Ç common.backends
‚îî‚îÄ‚îÄ tap_launcher/              # –∏—Å–ø–æ–ª—å–∑—É–µ—Ç common.backends
```

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
‚úÖ DRY - –∫–æ–¥ –ø–∏—à–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑  
‚úÖ –û–±–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â–∏–π –∫–æ–¥  
‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (4 —Å—Ç—Ä–æ–∫–∏ –≤ TapMonitor)  
‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å X11  
‚úÖ Protocol-based –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è (–≥–∏–±–∫–æ—Å—Ç—å)  

---

## –ö–∞–∫ –∏–∑—É—á–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (10 –º–∏–Ω—É—Ç)
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `WAYLAND-SUPPORT-PROPOSAL-v2.md`
2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å `PROJECT-STRUCTURE-v2.md`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å `poc-evdev-test.py`

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ (1 —á–∞—Å)
4. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `wayland-backend-design-v2.md`
5. –ò–∑—É—á–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤ `backend-examples/`
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã backend'–æ–≤

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ
7. `V1-TO-V2-CHANGES.md` - —ç–≤–æ–ª—é—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è
8. `ABC-VS-PROTOCOL.md` - –≤—ã–±–æ—Ä –ø–æ–¥—Ö–æ–¥–∞ –∫ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ evdev
```bash
# –ß–µ—Ä–µ–∑ uv
uv add --optional wayland evdev

# –ò–ª–∏ —á–µ—Ä–µ–∑ pip
pip install evdev
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É input
sudo usermod -a -G input $USER

# –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
```

### –ó–∞–ø—É—Å–∫ PoC —Ç–µ—Å—Ç–∞
```bash
python docs/20251024-052851-proposal-wayland_support/poc-evdev-test.py
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤
```bash
cd docs/20251024-052851-proposal-wayland_support/backend-examples
python 02-pynput-backend.py  # X11
python 03-evdev-backend-simplified.py  # Wayland
```

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ common –º–æ–¥—É–ª—è (2-3 —á)
- –°–æ–∑–¥–∞—Ç—å `src/common/backends/`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ backend'—ã
- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `key_normalizer.py`

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (1.5 —á)
- –û–±–Ω–æ–≤–∏—Ç—å `tap_detector/tap_monitor.py`
- –û–±–Ω–æ–≤–∏—Ç—å `tap_launcher/launcher_monitor.py`
- –û–±–Ω–æ–≤–∏—Ç—å `pyproject.toml`

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-3 —á)
- –¢–µ—Å—Ç—ã –Ω–∞ X11
- –¢–µ—Å—Ç—ã –Ω–∞ Wayland
- Edge cases

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 6-8 —á–∞—Å–æ–≤

---

## –†–µ—à–µ–Ω–∏—è –≤ ConPort

- **ID 8:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v1 (—É—Å—Ç–∞—Ä–µ–ª–æ)
- **ID 9:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v2 —Å `src/common/` (–∞–∫—Ç—É–∞–ª—å–Ω–æ)

**–¢–µ–≥–∏:** wayland, architecture, common-module, backend-abstraction, protocol

---

## –í–æ–ø—Ä–æ—Å—ã –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –£—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –≤ `src/common/`?
- –ß—Ç–æ –µ—â—ë –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ–±—â–∏–π –º–æ–¥—É–ª—å?

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Protocol –∏–ª–∏ ABC? (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Protocol)
- –ù—É–∂–Ω—ã –ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ backend'—ã?

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ PoC —Ç–µ—Å—Ç–æ–≤?
- –ù—É–∂–Ω—ã –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã?

---

## –°—Ç–∞—Ç—É—Å

- [x] –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω —Å–æ–∑–¥–∞–Ω
- [x] PoC —Ç–µ—Å—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –ü—Ä–∏–º–µ—Ä—ã backend'–æ–≤ —Å–æ–∑–¥–∞–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- [ ] –û–±—Å—É–∂–¥–µ–Ω–∏–µ —Å –∫–æ–º–∞–Ω–¥–æ–π
- [ ] –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–ê–≤—Ç–æ—Ä –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:** AI Assistant  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 24 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

